!function(e,t,a){var i,n=e.getElementsByTagName(t)[0];e.getElementById(a)||(i=e.createElement(t),i.id=a,i.src="//connect.facebook.net/bg_BG/sdk.js#xfbml=1&version=v2.4",n.parentNode.insertBefore(i,n))}(document,"script","facebook-jssdk"),function(e){"use strict";function t(){this.url="",this.modalWindowContent="",this.jackDevices,this.inArea=!1,this.modal,this.customEvent,this.deviceType,this.getSettings=function(){var t=this;e.ajax({url:ajaxObject.ajaxUrl,type:"GET",async:!1,dataType:"json",data:{action:"get_settings"}}).done(function(e){t.url=t.parseEscapedHtml(e.url),t.modalWindowContent=t.parseEscapedHtml(e.modal_window_content),t.jackDevices=e.jack_devices})},this.inspectClientDevice=function(){var e=navigator.userAgent||navigator.vendor||window.opera;e.match(/Android/i)?(this.customEvent="touchleave",this.deviceType="mobile"):e.match(/iPad|iPhone|iPod/i)?(this.customEvent="touchstart",this.deviceType="mobile"):this.deviceType="desktop"},this.parseEscapedHtml=function(t){return e("<div />").html(t).text()},this.deviceAllowed=function(){return-1!=this.jackDevices.indexOf(this.deviceType)},this.run=function(){this.appendModalToDom(),this.setTimer()},this.appendModalToDom=function(){this.modal=e('<div class="js-reveal-modal reveal-modal"/>');var t=e('<div class="js-modal-like-container modal-like-container"><div class="js-close-reveal close-reveal"></div><div id="ljn-main-button" class="fb-like" data-href="'+this.url+'" data-layout="standard" data-show-faces="false" data-action="like" data-share="false" data-width="300"></div></div>'),a=e("<p>"+this.modalWindowContent+"</p>"),i=e('<div id="ljn-referee" class="fb-like" data-href="http://www.bbc.co.uk/" data-layout="standard" data-action="like" data-show-faces="false" data-share="false" data-width="300"></div>');this.modal.append(a,t),e("body").append(i).prepend(this.modal)},this.appendReveal=function(){this.modal.reveal({closeonbackgroundclick:!1,dismissmodalclass:"js-close-reveal"})},this.jack=function(){this.registerEvents(),this.appendReveal()},this.setTimer=function(){var t=this,a=setInterval(function(){var i=e("#ljn-referee iframe"),n=e("#ljn-main-button iframe");if("undefined"!=typeof i&&"undefined"!=typeof n){var s=i.height(),o=n.height();if(!(20>s||o>100)){if(20==s||42==s||20==o)return void clearInterval(a);clearInterval(a),t.jack()}}},100)},this.registerEvents=function(){var t=this;e(".js-modal-like-container").on({mouseenter:function(){t.inArea=!0},mouseleave:function(){t.inArea=!1}}),e(document).on(this.customEvent,".js-close-reveal",function(){var t=e(".js-reveal-modal");t.addClass("modal-inactive-important"),t.children().css("display","none"),setTimeout(function(){t.css({display:"none"})},600)}),window.focus(),e(window).on("blur",function(){1==t.inArea&&setTimeout(function(){e(".js-close-reveal").click();var a=e(".js-reveal-modal");a.addClass("modal-inactive-important"),a.children().css("display","none"),setTimeout(function(){a.css({display:"none"})},600),e.ajax({url:ajaxObject.ajaxUrl,type:"POST",async:!0,data:{action:"log",ljn_url:t.url}})},500)})}}e(document).ready(function(){var e=new t;e.getSettings(),e.inspectClientDevice(),e.deviceAllowed()&&e.run()})}(jQuery);